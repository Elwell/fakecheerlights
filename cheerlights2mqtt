#!/usr/bin/python
# -*- coding: utf-8 -*-

import sys
import tweepy

import mosquitto
import json

import datetime
import time

import ConfigParser
config = ConfigParser.ConfigParser()
config.read('cheerlights.cfg')

colourdict = {'mediumvioletred': 'c71585', 'palegoldenrod': 'eee8aa', 'yellow': 'ffff00', 'grey61': '9c9c9c', 'grey60': '999999', 'grey63': 'a1a1a1', 'grey62': '9e9e9e', 'grey65': 'a6a6a6', 'aliceblue': 'f0f8ff', 'slate gray': '708090', 'grey66': 'a8a8a8', 'lightcyan1': 'e0ffff', 'grey68': 'adadad', 'lightcyan3': 'b4cdcd', 'lightcyan2': 'd1eeee', 'lightcyan4': '7a8b8b', 'gray32': '525252', 'gray33': '545454', 'darkturquoise': '00ced1', 'gray31': '4f4f4f', 'gray36': '5c5c5c', 'gray37': '5e5e5e', 'gray34': '575757', 'gray35': '595959', 'aquamarine4': '458b74', 'gray38': '616161', 'gray39': '636363', 'aquamarine1': '7fffd4', 'aquamarine3': '66cdaa', 'aquamarine2': '76eec6', 'misty rose': 'ffe4e1', 'cadetblue3': '7ac5cd', 'cadetblue2': '8ee5ee', 'cadetblue1': '98f5ff', 'violetred1': 'ff3e96', 'violetred2': 'ee3a8c', 'hotpink4': '8b3a62', 'violetred4': '8b2252', 'brown': 'a52a2a', 'darkgoldenrod': 'b8860b', 'gray8': '141414', 'slategrey': '708090', 'navajowhite2': 'eecfa1', 'gray2': '050505', 'cyan': '00ffff', 'gray0': '000000', 'gray1': '030303', 'gray6': '0f0f0f', 'gray7': '121212', 'gray4': '0a0a0a', 'gray5': '0d0d0d', 'mistyrose': 'ffe4e1', 'gray98': 'fafafa', 'darkkhaki': 'bdb76b', 'gray99': 'fcfcfc', 'grey11': '1c1c1c', 'coral4': '8b3e2f', 'grey12': '1f1f1f', 'grey64': 'a3a3a3', 'palegreen1': '9aff9a', 'palegreen3': '7ccd7c', 'palegreen2': '90ee90', 'palegreen4': '548b54', 'grey14': '242424', 'lavender': 'e6e6fa', 'chartreuse3': '66cd00', 'chartreuse2': '76ee00', 'dark slate blue': '483d8b', 'grey16': '292929', 'chartreuse4': '458b00', 'rosybrown': 'bc8f8f', 'blue': '0000ff', 'navajowhite': 'ffdead', 'lightseagreen': '20b2aa', 'maroon3': 'cd2990', 'dark khaki': 'bdb76b', 'maroon1': 'ff34b3', 'gold3': 'cdad00', 'gold2': 'eec900', 'gold1': 'ffd700', 'blueviolet': '8a2be2', 'lightslategrey': '778899', 'dim gray': '696969', 'gray30': '4d4d4d', 'medium purple': '9370db', 'green1': '00ff00', 'skyblue': '87ceeb', 'ghostwhite': 'f8f8ff', 'midnight blue': '191970', 'lavenderblush': 'fff0f5', 'seagreen': '2e8b57', 'blanchedalmond': 'ffebcd', 'gray60': '999999', 'darkolivegreen': '556b2f', 'firebrick2': 'ee2c2c', 'firebrick1': 'ff3030', 'pale green': '98fb98', 'firebrick4': '8b1a1a', 'sienna': 'a0522d', 'darkorchid4': '68228b', 'dodger blue': '1e90ff', 'gray55': '8c8c8c', 'lightsteelblue': 'b0c4de', 'darkviolet': '9400d3', 'blue4': '00008b', 'cadetblue4': '53868b', 'peru': 'cd853f', 'darkmagenta': '8b008b', 'lightblue2': 'b2dfee', 'lightblue3': '9ac0cd', 'red1': 'ff0000', 'lightblue1': 'bfefff', 'lightblue4': '68838b', 'red4': '8b0000', 'navy blue': '000080', 'mediumspringgreen': '00fa9a', 'chocolate': 'd2691e', 'mediumturquoise': '48d1cc', 'darkred': '8b0000', 'hotpink3': 'cd6090', 'hotpink2': 'ee6aa7', 'hotpink1': 'ff6eb4', 'slategray': '708090', 'grey18': '2e2e2e', 'grey19': '303030', 'dodgerblue3': '1874cd', 'floralwhite': 'fffaf0', 'moccasin': 'ffe4b5', 'grey10': '1a1a1a', 'chocolate1': 'ff7f24', 'chocolate2': 'ee7621', 'chocolate3': 'cd661d', 'chocolate4': '8b4513', 'grey15': '262626', 'dark orchid': '9932cc', 'grey17': '2b2b2b', 'gray69': 'b0b0b0', 'gray68': 'adadad', 'gray65': 'a6a6a6', 'gray64': 'a3a3a3', 'gray67': 'ababab', 'gray66': 'a8a8a8', 'gray61': '9c9c9c', 'coral': 'ff7f50', 'gray63': 'a1a1a1', 'gray62': '9e9e9e', 'lightgoldenrod': 'eedd82', 'seashell2': 'eee5de', 'seashell3': 'cdc5bf', 'magenta': 'ff00ff', 'seashell1': 'fff5ee', 'tan': 'd2b48c', 'seashell4': '8b8682', 'darkseagreen2': 'b4eeb4', 'pink': 'ffc0cb', 'medium aquamarine': '66cdaa', 'LightSlateBlue': '8470ff', 'chartreuse1': '7fff00', 'dark turquoise': '00ced1', 'papaya whip': 'ffefd5', 'SteelBlue1': '63b8ff', 'SteelBlue3': '4f94cd', 'SteelBlue2': '5cacee', 'SteelBlue4': '36648b', 'grey89': 'e3e3e3', 'grey88': 'e0e0e0', 'gray56': '8f8f8f', 'grey86': 'dbdbdb', 'grey85': 'd9d9d9', 'grey84': 'd6d6d6', 'grey83': 'd4d4d4', 'grey82': 'd1d1d1', 'grey81': 'cfcfcf', 'grey80': 'cccccc', 'tomato': 'ff6347', 'white smoke': 'f5f5f5', 'khaki1': 'fff68f', 'khaki2': 'eee685', 'khaki3': 'cdc673', 'salmon1': 'ff8c69', 'salmon3': 'cd7054', 'salmon2': 'ee8262', 'salmon4': '8b4c39', 'LightPink': 'ffb6c1', 'gray9': '171717', 'green': '00ff00', 'brown2': 'ee3b3b', 'brown3': 'cd3333', 'brown1': 'ff4040', 'brown4': '8b2323', 'cadet blue': '5f9ea0', 'orange4': '8b5a00', 'old lace': 'fdf5e6', 'orange3': 'cd8500', 'orange2': 'ee9a00', 'gray3': '080808', 'medium spring green': '00fa9a', 'yellow4': '8b8b00', 'yellow3': 'cdcd00', 'yellow2': 'eeee00', 'yellow1': 'ffff00', 'PapayaWhip': 'ffefd5', 'light sky blue': '87cefa', 'MediumOrchid3': 'b452cd', 'orange': 'ffa500', 'MediumOrchid2': 'd15fee', 'OliveDrab1': 'c0ff3e', 'OliveDrab2': 'b3ee3a', 'OliveDrab3': '9acd32', 'dark magenta': '8b008b', 'SkyBlue4': '4a708b', 'SkyBlue1': '87ceff', 'SkyBlue3': '6ca6cd', 'SkyBlue2': '7ec0ee', 'light slate gray': '778899', 'grey87': 'dedede', 'grey58': '949494', 'grey59': '969696', 'dark olive green': '556b2f', 'grey55': '8c8c8c', 'grey56': '8f8f8f', 'green yellow': 'adff2f', 'grey50': '7f7f7f', 'orange red': 'ff4500', 'grey52': '858585', 'grey53': '878787', 'cyan2': '00eeee', 'cyan3': '00cdcd', 'gray23': '3b3b3b', 'goldenrod': 'daa520', 'gray25': '404040', 'CornflowerBlue': '6495ed', 'cyan4': '008b8b', 'gray26': '424242', 'gray29': '4a4a4a', 'LimeGreen': '32cd32', 'dark violet': '9400d3', 'DarkBlue': '00008b', 'MediumSlateBlue': '7b68ee', 'dark orange': 'ff8c00', 'steel blue': '4682b4', 'navy': '000080', 'grey67': 'ababab', 'SeaGreen3': '43cd80', 'firebrick3': 'cd2626', 'gray94': 'f0f0f0', 'gray95': 'f2f2f2', 'gray96': 'f5f5f5', 'gray97': 'f7f7f7', 'gray90': 'e5e5e5', 'gray91': 'e8e8e8', 'gray92': 'ebebeb', 'gray93': 'ededed', 'MediumPurple': '9370db', 'MidnightBlue': '191970', 'cornsilk': 'fff8dc', 'red': 'ff0000', 'dark gray': 'a9a9a9', 'royal blue': '4169e1', 'grey69': 'b0b0b0', 'blue1': '0000ff', 'sky blue': '87ceeb', 'blue3': '0000cd', 'blue2': '0000ee', 'gainsboro': 'dcdcdc', 'DarkOrchid2': 'b23aee', 'DarkOrchid3': '9a32cd', 'lemon chiffon': 'fffacd', 'cornflower blue': '6495ed', 'plum4': '8b668b', 'alice blue': 'f0f8ff', 'rosy brown': 'bc8f8f', 'grey70': 'b3b3b3', 'DarkSeaGreen': '8fbc8f', 'grey71': 'b5b5b5', 'slate grey': '708090', 'grey77': 'c4c4c4', 'tomato4': '8b3626', 'tomato1': 'ff6347', 'grey74': 'bdbdbd', 'tomato3': 'cd4f39', 'tomato2': 'ee5c42', 'DarkSlateGray1': '97ffff', 'DarkSlateGray2': '8deeee', 'DarkSlateGray3': '79cdcd', 'DarkSlateGray4': '528b8b', 'SteelBlue': '4682b4', 'deep pink': 'ff1493', 'gray82': 'd1d1d1', 'pink3': 'cd919e', 'grey79': 'c9c9c9', 'MediumVioletRed': 'c71585', 'burlywood': 'deb887', 'light slate grey': '778899', 'dark blue': '00008b', 'white': 'ffffff', 'khaki4': '8b864e', 'blanched almond': 'ffebcd', 'DodgerBlue': '1e90ff', 'RoyalBlue4': '27408b', 'RoyalBlue1': '4876ff', 'RoyalBlue3': '3a5fcd', 'RoyalBlue2': '436eee', 'MistyRose1': 'ffe4e1', 'MistyRose3': 'cdb7b5', 'MistyRose2': 'eed5d2', 'MistyRose4': '8b7d7b', 'LightGray': 'd3d3d3', 'LightYellow': 'ffffe0', 'DarkOrange': 'ff8c00', 'medium blue': '0000cd', 'forest green': '228b22', 'gray73': 'bababa', 'grey41': '696969', 'gray70': 'b3b3b3', 'light green': '90ee90', 'DarkGray': 'a9a9a9', 'medium turquoise': '48d1cc', 'turquoise3': '00c5cd', 'turquoise2': '00e5ee', 'turquoise1': '00f5ff', 'burlywood2': 'eec591', 'saddle brown': '8b4513', 'turquoise4': '00868b', 'lawn green': '7cfc00', 'linen': 'faf0e6', 'grey47': '787878', 'snow': 'fffafa', 'grey46': '757575', 'gray58': '949494', 'gray59': '969696', 'IndianRed4': '8b3a3a', 'purple4': '551a8b', 'gray52': '858585', 'grey44': '707070', 'purple1': '9b30ff', 'LightSalmon': 'ffa07a', 'IndianRed2': 'ee6363', 'IndianRed3': 'cd5555', 'DarkOrchid1': 'bf3eff', 'thistle3': 'cdb5cd', 'SpringGreen1': '00ff7f', 'SpringGreen2': '00ee76', 'SpringGreen3': '00cd66', 'salmon': 'fa8072', 'thistle4': '8b7b8b', 'LightPink2': 'eea2ad', 'LightPink3': 'cd8c95', 'LightPink1': 'ffaeb9', 'antique white': 'faebd7', 'LightPink4': '8b5f65', 'MediumPurple1': 'ab82ff', 'MediumPurple2': '9f79ee', 'MediumPurple3': '8968cd', 'MediumPurple4': '5d478b', 'DimGray': '696969', 'gray14': '242424', 'grey100': 'ffffff', 'OrangeRed3': 'cd3700', 'OrangeRed2': 'ee4000', 'OrangeRed1': 'ff4500', 'maroon4': '8b1c62', 'gold': 'ffd700', 'OrangeRed4': '8b2500', 'NavajoWhite4': '8b795e', 'NavajoWhite1': 'ffdead', 'LawnGreen': '7cfc00', 'NavajoWhite3': 'cdb38b', 'LightGoldenrod4': '8b814c', 'LightGoldenrod1': 'ffec8b', 'LightGoldenrod3': 'cdbe70', 'LightGoldenrod2': 'eedc82', 'gray21': '363636', 'gray13': '212121', 'azure4': '838b8b', 'PaleGreen': '98fb98', 'green4': '008b00', 'violet red': 'd02090', 'DarkGreen': '006400', 'green3': '00cd00', 'green2': '00ee00', 'MediumOrchid': 'ba55d3', 'navajo white': 'ffdead', 'light steel blue': 'b0c4de', 'black': '000000', 'indian red': 'cd5c5c', 'gray20': '333333', 'orchid4': '8b4789', 'DodgerBlue1': '1e90ff', 'DodgerBlue2': '1c86ee', 'PeachPuff': 'ffdab9', 'DodgerBlue4': '104e8b', 'orchid1': 'ff83fa', 'orchid2': 'ee7ae9', 'orchid3': 'cd69c9', 'DarkSeaGreen4': '698b69', 'DarkSeaGreen3': '9bcd9b', 'yellow green': '9acd32', 'DarkSeaGreen1': 'c1ffc1', 'orange1': 'ffa500', 'gold4': '8b7500', 'grey72': 'b8b8b8', 'bisque4': '8b7d6b', 'MediumOrchid4': '7a378b', 'MintCream': 'f5fffa', 'MediumOrchid1': 'e066ff', 'bisque1': 'ffe4c4', 'bisque2': 'eed5b7', 'bisque3': 'cdb79e', 'gray': 'bebebe', 'DeepSkyBlue': '00bfff', 'LightGrey': 'd3d3d3', 'grey78': 'c7c7c7', 'gray22': '383838', 'RosyBrown3': 'cd9b9b', 'plum3': 'cd96cd', 'plum2': 'eeaeee', 'plum1': 'ffbbff', 'DarkSlateGrey': '2f4f4f', 'DarkOrchid': '9932cc', 'OliveDrab': '6b8e23', 'gray83': 'd4d4d4', 'grey': 'bebebe', 'grey49': '7d7d7d', 'grey48': '7a7a7a', 'thistle': 'd8bfd8', 'violet': 'ee82ee', 'grey43': '6e6e6e', 'grey42': '6b6b6b', 'LightSalmon4': '8b5742', 'grey40': '666666', 'LightSalmon2': 'ee9572', 'LightSalmon3': 'cd8162', 'grey45': '737373', 'LightSalmon1': 'ffa07a', 'honeydew': 'f0fff0', 'gray18': '2e2e2e', 'gray19': '303030', 'LightCyan': 'e0ffff', 'gray15': '262626', 'gray16': '292929', 'gray17': '2b2b2b', 'gray10': '1a1a1a', 'gray11': '1c1c1c', 'gray12': '1f1f1f', 'pale violet red': 'db7093', 'thistle2': 'eed2ee', 'grey93': 'ededed', 'light slate blue': '8470ff', 'PaleGoldenrod': 'eee8aa', 'DarkSlateGray': '2f4f4f', 'AntiqueWhite3': 'cdc0b0', 'AntiqueWhite2': 'eedfcc', 'AntiqueWhite1': 'ffefdb', 'gray27': '454545', 'SlateBlue': '6a5acd', 'AntiqueWhite4': '8b8378', 'RosyBrown4': '8b6969', 'DimGrey': '696969', 'VioletRed': 'd02090', 'WhiteSmoke': 'f5f5f5', 'grey38': '616161', 'grey39': '636363', 'grey36': '5c5c5c', 'grey37': '5e5e5e', 'grey34': '575757', 'hot pink': 'ff69b4', 'grey32': '525252', 'grey33': '545454', 'grey30': '4d4d4d', 'grey31': '4f4f4f', 'NavyBlue': '000080', 'sienna4': '8b4726', 'gray81': 'cfcfcf', 'gray80': 'cccccc', 'sienna1': 'ff8247', 'gray86': 'dbdbdb', 'sienna3': 'cd6839', 'sienna2': 'ee7942', 'gray89': 'e3e3e3', 'gray88': 'e0e0e0', 'magenta2': 'ee00ee', 'magenta4': '8b008b', 'gray87': 'dedede', 'magenta3': 'cd00cd', 'IndianRed': 'cd5c5c', 'SlateBlue2': '7a67ee', 'magenta1': 'ff00ff', 'blue violet': '8a2be2', 'LightBlue': 'add8e6', 'grey75': 'bfbfbf', 'PeachPuff4': '8b7765', 'seashell': 'fff5ee', 'SaddleBrown': '8b4513', 'PeachPuff1': 'ffdab9', 'PeachPuff2': 'eecbad', 'PeachPuff3': 'cdaf95', 'dark goldenrod': 'b8860b', 'gray100': 'ffffff', 'aquamarine': '7fffd4', 'LemonChiffon2': 'eee9bf', 'LemonChiffon1': 'fffacd', 'tan4': '8b5a2b', 'tan3': 'cd853f', 'tan2': 'ee9a49', 'tan1': 'ffa54f', 'LemonChiffon4': '8b8970', 'IndianRed1': 'ff6a6a', 'red3': 'cd0000', 'OliveDrab4': '698b22', 'OldLace': 'fdf5e6', 'LightSkyBlue': '87cefa', 'gray84': 'd6d6d6', 'PowderBlue': 'b0e0e6', 'RoyalBlue': '4169e1', 'LightSkyBlue4': '607b8b', 'VioletRed3': 'cd3278', 'LightSkyBlue1': 'b0e2ff', 'LightSkyBlue2': 'a4d3ee', 'LightSkyBlue3': '8db6cd', 'dark cyan': '008b8b', 'LightYellow1': 'ffffe0', 'LightYellow2': 'eeeed1', 'LightYellow3': 'cdcdb4', 'LightYellow4': '8b8b7a', 'goldenrod4': '8b6914', 'grey35': '595959', 'goldenrod1': 'ffc125', 'goldenrod2': 'eeb422', 'goldenrod3': 'cd9b1d', 'light goldenrod yellow': 'fafad2', 'LemonChiffon': 'fffacd', 'burlywood1': 'ffd39b', 'YellowGreen': '9acd32', 'LightCoral': 'f08080', 'burlywood3': 'cdaa7d', 'ivory3': 'cdcdc1', 'ivory2': 'eeeee0', 'ivory1': 'fffff0', 'grey8': '141414', 'ivory4': '8b8b83', 'mint cream': 'f5fffa', 'grey9': '171717', 'burlywood4': '8b7355', 'DarkSalmon': 'e9967a', 'SlateGray1': 'c6e2ff', 'SlateGray2': 'b9d3ee', 'SlateGray3': '9fb6cd', 'SlateGray4': '6c7b8b', 'RosyBrown2': 'eeb4b4', 'RosyBrown1': 'ffc1c1', 'dark grey': 'a9a9a9', 'dark salmon': 'e9967a', 'gray85': 'd9d9d9', 'medium orchid': 'ba55d3', 'LightGreen': '90ee90', 'LavenderBlush1': 'fff0f5', 'grey73': 'bababa', 'LavenderBlush3': 'cdc1c5', 'LavenderBlush2': 'eee0e5', 'grey76': 'c2c2c2', 'LavenderBlush4': '8b8386', 'deep sky blue': '00bfff', 'dark slate gray': '2f4f4f', 'pink1': 'ffb5c5', 'OrangeRed': 'ff4500', 'pink2': 'eea9b8', 'pink4': '8b636c', 'gray47': '787878', 'gray46': '757575', 'gray45': '737373', 'gray44': '707070', 'gray43': '6e6e6e', 'gray42': '6b6b6b', 'gray41': '696969', 'gray40': '666666', 'gray49': '7d7d7d', 'gray48': '7a7a7a', 'MediumAquamarine': '66cdaa', 'light gray': 'd3d3d3', 'powder blue': 'b0e0e6', 'azure1': 'f0ffff', 'azure3': 'c1cdcd', 'azure2': 'e0eeee', 'sea green': '2e8b57', 'firebrick': 'b22222', 'grey54': '8a8a8a', 'DarkGrey': 'a9a9a9', 'grey57': '919191', 'medium slate blue': '7b68ee', 'light yellow': 'ffffe0', 'SlateBlue4': '473c8b', 'SlateBlue3': '6959cd', 'pale turquoise': 'afeeee', 'SlateBlue1': '836fff', 'grey51': '828282', 'chartreuse': '7fff00', 'dark sea green': '8fbc8f', 'DarkOliveGreen4': '6e8b3d', 'turquoise': '40e0d0', 'DarkOliveGreen1': 'caff70', 'DarkOliveGreen3': 'a2cd5a', 'DarkOliveGreen2': 'bcee68', 'grey6': '0f0f0f', 'grey7': '121212', 'grey4': '0a0a0a', 'grey5': '0d0d0d', 'grey2': '050505', 'grey3': '080808', 'grey0': '000000', 'grey1': '030303', 'gray50': '7f7f7f', 'cyan1': '00ffff', 'gray51': '828282', 'gray24': '3d3d3d', 'gray53': '878787', 'HotPink': 'ff69b4', 'DarkGoldenrod4': '8b6508', 'gray54': '8a8a8a', 'DarkGoldenrod1': 'ffb90f', 'DarkGoldenrod2': 'eead0e', 'DarkGoldenrod3': 'cd950c', 'purple3': '7d26cd', 'DeepPink': 'ff1493', 'gray28': '474747', 'purple2': '912cee', 'DarkCyan': '008b8b', 'peach puff': 'ffdab9', 'GreenYellow': 'adff2f', 'DebianRed': 'd70751', 'DarkOrange4': '8b4500', 'DarkOrange1': 'ff7f00', 'DarkOrange3': 'cd6600', 'orchid': 'da70d6', 'purple': 'a020f0', 'grey27': '454545', 'wheat4': '8b7e66', 'wheat1': 'ffe7ba', 'wheat3': 'cdba96', 'wheat2': 'eed8ae', 'coral3': 'cd5b45', 'coral2': 'ee6a50', 'coral1': 'ff7256', 'thistle1': 'ffe1ff', 'PaleTurquoise': 'afeeee', 'bisque': 'ffe4c4', 'DeepPink3': 'cd1076', 'DeepPink2': 'ee1289', 'DeepPink1': 'ff1493', 'khaki': 'f0e68c', 'wheat': 'f5deb3', 'MediumSeaGreen': '3cb371', 'DeepPink4': '8b0a50', 'SpringGreen4': '008b45', 'DarkSlateBlue': '483d8b', 'PaleVioletRed4': '8b475d', 'PaleVioletRed1': 'ff82ab', 'PaleVioletRed2': 'ee799f', 'PaleVioletRed3': 'cd6889', 'dark slate grey': '2f4f4f', 'AntiqueWhite': 'faebd7', 'light salmon': 'ffa07a', 'PaleTurquoise4': '668b8b', 'PaleTurquoise3': '96cdcd', 'PaleTurquoise2': 'aeeeee', 'PaleTurquoise1': 'bbffff', 'light grey': 'd3d3d3', 'plum': 'dda0dd', 'beige': 'f5f5dc', 'SpringGreen': '00ff7f', 'azure': 'f0ffff', 'honeydew1': 'f0fff0', 'honeydew2': 'e0eee0', 'honeydew3': 'c1cdc1', 'honeydew4': '838b83', 'gray57': '919191', 'snow4': '8b8989', 'snow2': 'eee9e9', 'snow3': 'cdc9c9', 'snow1': 'fffafa', 'SandyBrown': 'f4a460', 'grey13': '212121', 'SeaGreen4': '2e8b57', 'sandy brown': 'f4a460', 'SeaGreen2': '4eee94', 'SeaGreen1': '54ff9f', 'grey29': '4a4a4a', 'grey28': '474747', 'grey25': '404040', 'grey24': '3d3d3d', 'light pink': 'ffb6c1', 'grey26': '424242', 'grey21': '363636', 'grey20': '333333', 'grey23': '3b3b3b', 'grey22': '383838', 'gray78': 'c7c7c7', 'gray79': 'c9c9c9', 'gray76': 'c2c2c2', 'gray77': 'c4c4c4', 'gray74': 'bdbdbd', 'gray75': 'bfbfbf', 'gray72': 'b8b8b8', 'medium sea green': '3cb371', 'olive drab': '6b8e23', 'gray71': 'b5b5b5', 'ghost white': 'f8f8ff', 'ivory': 'fffff0', 'light coral': 'f08080', 'LemonChiffon3': 'cdc9a5', 'DeepSkyBlue4': '00688b', 'DeepSkyBlue3': '009acd', 'DeepSkyBlue2': '00b2ee', 'DeepSkyBlue1': '00bfff', 'cornsilk4': '8b8878', 'cornsilk2': 'eee8cd', 'cornsilk3': 'cdc8b1', 'CadetBlue': '5f9ea0', 'cornsilk1': 'fff8dc', 'grey90': 'e5e5e5', 'grey91': 'e8e8e8', 'grey92': 'ebebeb', 'light cyan': 'e0ffff', 'grey94': 'f0f0f0', 'floral white': 'fffaf0', 'grey96': 'f5f5f5', 'grey97': 'f7f7f7', 'grey98': 'fafafa', 'grey99': 'fcfcfc', 'LightSteelBlue1': 'cae1ff', 'LightSteelBlue2': 'bcd2ee', 'LightSteelBlue3': 'a2b5cd', 'LightSteelBlue4': '6e7b8b', 'red2': 'ee0000', 'maroon': 'b03060', 'light sea green': '20b2aa', 'spring green': '00ff7f', 'light goldenrod': 'eedd82', 'light blue': 'add8e6', 'lime green': '32cd32', 'grey95': 'f2f2f2', 'LightGoldenrodYellow': 'fafad2', 'MediumBlue': '0000cd', 'LightSlateGray': '778899', 'lavender blush': 'fff0f5', 'DarkOrange2': 'ee7600', 'PaleVioletRed': 'db7093', 'maroon2': 'ee30a7', 'dim grey': '696969', 'ForestGreen': '228b22', 'dark red': '8b0000', 'slate blue': '6a5acd', 'dark green': '006400', 'warmwhite': 'fffff0'}


# Get these values from your application settings
CONSUMER_KEY = config.get('twitter','consumer_key')
CONSUMER_SECRET = config.get('twitter','consumer_secret')
ACCESS_TOKEN = config.get('twitter','access_token')
ACCESS_TOKEN_SECRET = config.get('twitter','access_token_secret')

# The above are defined in config file

auth = tweepy.OAuthHandler(CONSUMER_KEY, CONSUMER_SECRET)
auth.set_access_token(ACCESS_TOKEN, ACCESS_TOKEN_SECRET)

# Note: Had you wanted to perform the full OAuth dance instead of using
# an access key and access secret, you could have uses the following 
# four lines of code instead of the previous line that manually set the
# access token via auth.set_access_token(ACCESS_TOKEN, ACCESS_TOKEN_SECRET)
# 
# import webbrowser
# auth_url = auth.get_authorization_url(signin_with_twitter=True)
# webbrowser.open(auth_url)
# verifier = raw_input('PIN: ').strip()
# auth.get_access_token(verifier)


# open a mqtt publisher
mqttc = mosquitto.Mosquitto()
mqtt_user = config.get('cheerbot','mqtt_user')
mqtt_pass = config.get('cheerbot','mqtt_pass')
#mqttc.username_pw_set(mqtt_user,mqtt_pass)
# username and pass are in config file
mqttc.connect("localhost")

class CustomStreamListener(tweepy.StreamListener):

    def on_status(self, status):
        try:
           st = status.text
           by = status.user.screen_name
           ts = int(time.mktime(status.created_at.timetuple())) # twitter already uses UTC
           x = '{ "tweet": "%s", "by": "%s", "at": "%s" }' % (st, by, ts)
           # do the MQTT thing
           mqttc.publish("fakecheerlights/raw", str(x), retain=True)
           for w in status.text.split():
              entry = colourdict.get(w)
              if entry:
                 mqttc.publish("fakecheerlights/colour", str(w), retain=True)
                 mqttc.publish("fakecheerlights/rgb", str(entry), retain=True)
           print x, w, entry
        except Exception, e:
            print >> sys.stderr, 'Encountered Exception:', e
            pass

    def on_error(self, status_code):
        print >> sys.stderr, 'Encountered error with status code:', status_code
        return True # Don't kill the stream

    def on_timeout(self):
        print >> sys.stderr, 'Timeout...'
        return True # Don't kill the stream

# Create a streaming API and set a timeout value of 60 seconds

streaming_api = tweepy.streaming.Stream(auth, CustomStreamListener(), timeout=60)

mqttc.loop_start()

# Optionally filter the statuses you want to track by providing a list
# of users to "follow"
streaming_api.filter(track=['cheerlights','fakecheerlights'])
